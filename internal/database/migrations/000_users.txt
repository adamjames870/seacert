-- +goose Up

CREATE TABLE users (
    id uuid PRIMARY KEY,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    name VARCHAR NOT NULL,
    email VARCHAR,
    hashed_password VARCHAR NOT NULL DEFAULT 'unset'
);

ALTER TABLE certificates
    ADD COLUMN user_id UUID;

ALTER TABLE certificates
    ADD FOREIGN KEY (user_id)
        REFERENCES users(id)
        ON DELETE CASCADE;


-- +goose Down

ALTER TABLE certificates
    DROP CONSTRAINT IF EXISTS fk_certificates_user;

ALTER TABLE certificates
    DROP COLUMN IF EXISTS user_id;

DROP TABLE users;