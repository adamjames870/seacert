// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: certs.sql

package sqlc

import (
	"context"
	"database/sql"
	"time"

	"github.com/google/uuid"
)

const createCert = `-- name: CreateCert :one
INSERT INTO certificates (id, created_at, updated_at, user_id, cert_type_id, cert_number, issuer_id, issued_date, alternative_name, remarks, manual_expiry)
VALUES (
           $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11
       )
RETURNING id, created_at, updated_at, cert_number, issued_date, cert_type_id, alternative_name, remarks, issuer_id, user_id, manual_expiry, deleted
`

type CreateCertParams struct {
	ID              uuid.UUID
	CreatedAt       time.Time
	UpdatedAt       time.Time
	UserID          uuid.UUID
	CertTypeID      uuid.UUID
	CertNumber      string
	IssuerID        uuid.UUID
	IssuedDate      time.Time
	AlternativeName sql.NullString
	Remarks         sql.NullString
	ManualExpiry    sql.NullTime
}

func (q *Queries) CreateCert(ctx context.Context, arg CreateCertParams) (Certificate, error) {
	row := q.db.QueryRowContext(ctx, createCert,
		arg.ID,
		arg.CreatedAt,
		arg.UpdatedAt,
		arg.UserID,
		arg.CertTypeID,
		arg.CertNumber,
		arg.IssuerID,
		arg.IssuedDate,
		arg.AlternativeName,
		arg.Remarks,
		arg.ManualExpiry,
	)
	var i Certificate
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CertNumber,
		&i.IssuedDate,
		&i.CertTypeID,
		&i.AlternativeName,
		&i.Remarks,
		&i.IssuerID,
		&i.UserID,
		&i.ManualExpiry,
		&i.Deleted,
	)
	return i, err
}

const createSuccession = `-- name: CreateSuccession :one
INSERT INTO successions (id, old_cert, new_cert, reason) VALUES ($1, $2, $3, $4)
RETURNING id, new_cert, old_cert, reason
`

type CreateSuccessionParams struct {
	ID      uuid.UUID
	OldCert uuid.UUID
	NewCert uuid.UUID
	Reason  SuccessionReason
}

func (q *Queries) CreateSuccession(ctx context.Context, arg CreateSuccessionParams) (Succession, error) {
	row := q.db.QueryRowContext(ctx, createSuccession,
		arg.ID,
		arg.OldCert,
		arg.NewCert,
		arg.Reason,
	)
	var i Succession
	err := row.Scan(
		&i.ID,
		&i.NewCert,
		&i.OldCert,
		&i.Reason,
	)
	return i, err
}

const deleteCert = `-- name: DeleteCert :exec
DELETE FROM certificates WHERE id=$1 AND user_id=$2
`

type DeleteCertParams struct {
	ID     uuid.UUID
	UserID uuid.UUID
}

func (q *Queries) DeleteCert(ctx context.Context, arg DeleteCertParams) error {
	_, err := q.db.ExecContext(ctx, deleteCert, arg.ID, arg.UserID)
	return err
}

const getCertFromId = `-- name: GetCertFromId :one
SELECT
    certificates.id AS id,
    certificates.created_at AS created_at,
    certificates.updated_at AS updated_at,
    cert_number,
    issued_date,
    alternative_name,
    remarks,
    manual_expiry,
    deleted,
    EXISTS (
        SELECT true
        FROM successions s
        WHERE s.new_cert = certificates.id
    ) as has_predecessors,
    EXISTS (
        SELECT true
        FROM successions s
        WHERE s.old_cert = certificates.id
    ) as has_successor,
    certificate_types.id AS cert_type_id,
    certificate_types.created_at AS cert_type_created_at,
    certificate_types.updated_at AS cert_type_updated_at,
    certificate_types.name AS cert_type_name,
    certificate_types.short_name AS cert_type_short_name,
    certificate_types.stcw_reference AS cert_type_stcw_reference,
    certificate_types.normal_validity_months AS normal_validity_months,
    issuers.id AS issuer_id,
    issuers.created_at AS issuer_created_at,
    issuers.updated_at AS issuer_updated_at,
    issuers.name AS issuer_name,
    issuers.country AS issuer_country,
    issuers.website AS issuer_website
FROM certificates
INNER JOIN certificate_types ON certificate_types.id=certificates.cert_type_id
INNER JOIN issuers ON issuers.id=certificates.issuer_id
WHERE certificates.id=$1 AND certificates.user_id=$2
`

type GetCertFromIdParams struct {
	ID     uuid.UUID
	UserID uuid.UUID
}

type GetCertFromIdRow struct {
	ID                    uuid.UUID
	CreatedAt             time.Time
	UpdatedAt             time.Time
	CertNumber            string
	IssuedDate            time.Time
	AlternativeName       sql.NullString
	Remarks               sql.NullString
	ManualExpiry          sql.NullTime
	Deleted               bool
	HasPredecessors       bool
	HasSuccessor          bool
	CertTypeID            uuid.UUID
	CertTypeCreatedAt     time.Time
	CertTypeUpdatedAt     time.Time
	CertTypeName          string
	CertTypeShortName     string
	CertTypeStcwReference sql.NullString
	NormalValidityMonths  sql.NullInt32
	IssuerID              uuid.UUID
	IssuerCreatedAt       time.Time
	IssuerUpdatedAt       time.Time
	IssuerName            string
	IssuerCountry         sql.NullString
	IssuerWebsite         sql.NullString
}

func (q *Queries) GetCertFromId(ctx context.Context, arg GetCertFromIdParams) (GetCertFromIdRow, error) {
	row := q.db.QueryRowContext(ctx, getCertFromId, arg.ID, arg.UserID)
	var i GetCertFromIdRow
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CertNumber,
		&i.IssuedDate,
		&i.AlternativeName,
		&i.Remarks,
		&i.ManualExpiry,
		&i.Deleted,
		&i.HasPredecessors,
		&i.HasSuccessor,
		&i.CertTypeID,
		&i.CertTypeCreatedAt,
		&i.CertTypeUpdatedAt,
		&i.CertTypeName,
		&i.CertTypeShortName,
		&i.CertTypeStcwReference,
		&i.NormalValidityMonths,
		&i.IssuerID,
		&i.IssuerCreatedAt,
		&i.IssuerUpdatedAt,
		&i.IssuerName,
		&i.IssuerCountry,
		&i.IssuerWebsite,
	)
	return i, err
}

const getCerts = `-- name: GetCerts :many
SELECT
    certificates.id AS id,
    certificates.created_at AS created_at,
    certificates.updated_at AS updated_at,
    cert_number,
    issued_date,
    alternative_name,
    remarks,
    manual_expiry,
    deleted,
    EXISTS (
        SELECT true
        FROM successions s
        WHERE s.new_cert = certificates.id
    ) as has_predecessors,
    EXISTS (
        SELECT true
        FROM successions s
        WHERE s.old_cert = certificates.id
    ) as has_successor,
    certificate_types.id AS cert_type_id,
    certificate_types.created_at AS cert_type_created_at,
    certificate_types.updated_at AS cert_type_updated_at,
    certificate_types.name AS cert_type_name,
    certificate_types.short_name AS cert_type_short_name,
    certificate_types.stcw_reference AS cert_type_stcw_reference,
    certificate_types.normal_validity_months AS normal_validity_months,
    issuers.id AS issuer_id,
    issuers.created_at AS issuer_created_at,
    issuers.updated_at AS issuer_updated_at,
    issuers.name AS issuer_name,
    issuers.country AS issuer_country,
    issuers.website AS issuer_website
FROM certificates
INNER JOIN certificate_types ON certificate_types.id=certificates.cert_type_id
INNER JOIN issuers ON issuers.id=certificates.issuer_id
WHERE user_id=$1
`

type GetCertsRow struct {
	ID                    uuid.UUID
	CreatedAt             time.Time
	UpdatedAt             time.Time
	CertNumber            string
	IssuedDate            time.Time
	AlternativeName       sql.NullString
	Remarks               sql.NullString
	ManualExpiry          sql.NullTime
	Deleted               bool
	HasPredecessors       bool
	HasSuccessor          bool
	CertTypeID            uuid.UUID
	CertTypeCreatedAt     time.Time
	CertTypeUpdatedAt     time.Time
	CertTypeName          string
	CertTypeShortName     string
	CertTypeStcwReference sql.NullString
	NormalValidityMonths  sql.NullInt32
	IssuerID              uuid.UUID
	IssuerCreatedAt       time.Time
	IssuerUpdatedAt       time.Time
	IssuerName            string
	IssuerCountry         sql.NullString
	IssuerWebsite         sql.NullString
}

func (q *Queries) GetCerts(ctx context.Context, userID uuid.UUID) ([]GetCertsRow, error) {
	rows, err := q.db.QueryContext(ctx, getCerts, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetCertsRow
	for rows.Next() {
		var i GetCertsRow
		if err := rows.Scan(
			&i.ID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.CertNumber,
			&i.IssuedDate,
			&i.AlternativeName,
			&i.Remarks,
			&i.ManualExpiry,
			&i.Deleted,
			&i.HasPredecessors,
			&i.HasSuccessor,
			&i.CertTypeID,
			&i.CertTypeCreatedAt,
			&i.CertTypeUpdatedAt,
			&i.CertTypeName,
			&i.CertTypeShortName,
			&i.CertTypeStcwReference,
			&i.NormalValidityMonths,
			&i.IssuerID,
			&i.IssuerCreatedAt,
			&i.IssuerUpdatedAt,
			&i.IssuerName,
			&i.IssuerCountry,
			&i.IssuerWebsite,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getPredecessors = `-- name: GetPredecessors :many
SELECT
    old_cert,
    reason AS reason
FROM successions
WHERE new_cert=$1
`

type GetPredecessorsRow struct {
	OldCert uuid.UUID
	Reason  SuccessionReason
}

func (q *Queries) GetPredecessors(ctx context.Context, newCert uuid.UUID) ([]GetPredecessorsRow, error) {
	rows, err := q.db.QueryContext(ctx, getPredecessors, newCert)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetPredecessorsRow
	for rows.Next() {
		var i GetPredecessorsRow
		if err := rows.Scan(&i.OldCert, &i.Reason); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateCertificate = `-- name: UpdateCertificate :one
UPDATE certificates
SET
    cert_number=COALESCE($2, cert_number),
    issued_date=COALESCE($3, issued_date),
    cert_type_id=COALESCE($4, cert_type_id),
    alternative_name=COALESCE($5, alternative_name),
    remarks=COALESCE($6, remarks),
    issuer_id=COALESCE($7, issuer_id),
    manual_expiry=COALESCE($8, manual_expiry),
    deleted=COALESCE($9, deleted),
    updated_at=NOW()
WHERE id=$1
RETURNING id, created_at, updated_at, cert_number, issued_date, cert_type_id, alternative_name, remarks, issuer_id, user_id, manual_expiry, deleted
`

type UpdateCertificateParams struct {
	ID              uuid.UUID
	CertNumber      sql.NullString
	IssuedDate      sql.NullTime
	CertTypeID      uuid.NullUUID
	AlternativeName sql.NullString
	Remarks         sql.NullString
	IssuerID        uuid.NullUUID
	ManualExpiry    sql.NullTime
	Deleted         sql.NullBool
}

func (q *Queries) UpdateCertificate(ctx context.Context, arg UpdateCertificateParams) (Certificate, error) {
	row := q.db.QueryRowContext(ctx, updateCertificate,
		arg.ID,
		arg.CertNumber,
		arg.IssuedDate,
		arg.CertTypeID,
		arg.AlternativeName,
		arg.Remarks,
		arg.IssuerID,
		arg.ManualExpiry,
		arg.Deleted,
	)
	var i Certificate
	err := row.Scan(
		&i.ID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.CertNumber,
		&i.IssuedDate,
		&i.CertTypeID,
		&i.AlternativeName,
		&i.Remarks,
		&i.IssuerID,
		&i.UserID,
		&i.ManualExpiry,
		&i.Deleted,
	)
	return i, err
}
